<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>নিত্য সদাই</title>
<link rel="icon" type="image/png" href="favicon.png">
<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="assets/css/styles2.css">
<link rel="stylesheet" href="assets/css/styles.css">
<style>
.fake-input { width: 100%; padding: 10px; margin: 6px 0; border: 4px solid black; border-radius: 8px; font-size: 14px; background: white; font-weight: bold; text-align: left; }
.fake-input del { color: gray; margin-right: 8px; }
.fake-input .price-discount { color: red; font-weight: bold; }
.add-to-cart { margin-top: 10px; padding: 12px 18px; background: red; color: white; border: 4px solid black; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; }
.add-to-cart:hover { background: aqua; color: black; }
.game-card.highlight { animation: highlightCard 0.8s ease-in-out; }
@keyframes highlightCard { 0% { transform: scale(1); box-shadow: 0 0 0 rgba(255,87,34,0.5); } 50% { transform: scale(1.1); box-shadow: 0 0 15px rgba(255,87,34,0.7); } 100% { transform: scale(1); box-shadow: 0 0 0 rgba(255,87,34,0); } }
.navbar a { text-decoration: none; }
.price-original { color: gray; text-decoration: line-through; }
.price-discount { color: red; font-weight: bold; }
</style>
</head>
<body>
<header><i class="fas fa-store"></i>নিত্য <span class="span-all">সদাই</span></header>
<marquee><i class="fas fa-tags"></i> আজকের বিশেষ অফার! চাল, ডাল, তেল, চিনি সহ সব পণ্যে বিশেষ ছাড় চলছে। দ্রুত অর্ডার করুন!</marquee>

<div class="search-box">
  <input type="text" id="searchInput" placeholder="পণ্য বা ট্যাগস খুঁজুন...">
  <div class="suggestions" id="suggestions"></div>
</div>

<div class="game-section">
  <h3>ছোট বাচ্চাদের জিনিসপত্র!</h3>
  <div class="game-types" id="product-list"></div>
</div>

<footer>
  <div class="footer-container">
    <div class="footer-left">
      <h2><i class="fas fa-store"></i> নিত্য <span class="span-all">সদাই</span></h2>
      <p><i class="fas fa-copyright"></i> এই সাইটের কোনো অংশ বা Ui বা ডিজাইন কপি করা হলে তার বিরুদ্ধে একশন নেওয়া হবে! | Created By <a href="https://XrabonProgrammer.netlify.app/"><span>Xrabon</span></a></p>
    </div>
    <div class="footer-right">
      <a href="https://m.facebook.com/nittosodai.coms/"><i class="fab fa-facebook-f"></i></a>
      <a href="nittosodai2025@gmail.com"><i class="fas fa-envelope"></i></a>
      <a href="https://www.instagram.com/nittosodai.coms/"><i class="fab fa-instagram"></i></a>
      <a href="https://youtube.com/@nittosodai-sabirin?si=eaj5s_bIryV8kizA"><i class="fab fa-youtube"></i></a>
    </div>
  </div>
</footer>

<div class="navbar">
  <a href="index.html" class="nav-item active" style="text-decoration:none;">
    <i class="fa-solid fa-house"></i> Home
  </a>

  <a href="#" class="nav-item" id="profile-btn">
    <i class="fa-solid fa-globe"></i> Language
  </a>

  <div id="profile-popup" class="popup-menu">
    <button id="bn-btn" class="active">
      <img src="https://flagcdn.com/bd.svg" alt="Bangladesh" class="flag-icon"> বাংলা
    </button>
    <button id="en-btn">
      <img src="https://flagcdn.com/us.svg" alt="USA" class="flag-icon"> English
    </button>
  </div>

  <a href="NewCart.html" class="nav-item" style="text-decoration:none;">
    <i class="fa-solid fa-cart-arrow-down"></i>
    <span id="cart-count">0</span> Carts
  </a>
  <a href="#" class="nav-item" style="text-decoration:none;">
    <i class="fas fa-user"></i> Developer
  </a>
  <a href="#" class="nav-item" style="text-decoration:none;">
    <i class="fas fa-user"></i> Seller
  </a>
</div>

<style>
.flag-icon {
  width: 20px;
  height: 14px;
  margin-right: 8px;
  vertical-align: middle;
}

.popup-menu {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.4);
  padding: 20px 30px;
  display: none;
  flex-direction: column;
  gap: 15px;
  z-index: 9999;
  min-width: 200px;
  text-align: center;
  animation: fadeInScale 0.3s ease forwards;
}

.popup-menu button {
  border: none;
  background-color: #f0f0f0;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.popup-menu button.active {
  background-color: #007bff;
  color: #fff;
}

.popup-menu button:hover {
  background-color: #0056b3;
  color: #fff;
}

@keyframes fadeInScale {
  0% { opacity: 0; transform: translate(-50%, -50%) scale(0.7); }
  100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

.flag-icon {
  width: 20px;
  height: 14px;
  margin-right: 8px;
  vertical-align: middle;
}

.popup-menu button {
  border: none;
  background-color: #f0f0f0;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.popup-menu button.active {
  background-color: #007bff;
  color: #fff;
}

.popup-menu button:hover {
  background-color: #0056b3;
  color: #fff;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateX(-50%) translateY(-10px);}
  to { opacity: 1; transform: translateX(-50%) translateY(0);}
}
</style>

<script>
const profileBtn = document.getElementById('profile-btn')
const popupMenu = document.getElementById('profile-popup')

profileBtn.addEventListener('click', e => {
  e.preventDefault()
  popupMenu.style.display = popupMenu.style.display === 'flex' ? 'none' : 'flex'
  popupMenu.style.flexDirection = 'column'
})

document.addEventListener('click', e => {
  if (!profileBtn.contains(e.target) && !popupMenu.contains(e.target)) {
    popupMenu.style.display = 'none'
  }
})
</script>
<script>
  (function(){
    var enBtn = document.getElementById('en-btn');
    var bnBtn = document.getElementById('bn-btn');
    var targetSite = 'https://nittosodai71.netlify.app/6thDial.html';

    function setActiveBtn(activeBtn) {
      var bn = document.getElementById('bn-btn');
      var en = document.getElementById('en-btn');
      bn.classList.remove('active');
      en.classList.remove('active');
      activeBtn.classList.add('active');
    }

    enBtn.addEventListener('click', function(e){
      e.preventDefault();
      setActiveBtn(enBtn);
      var translateUrl = 'https://translate.google.com/translate?sl=auto&tl=en&u=' + encodeURIComponent(targetSite);
      window.location.href = translateUrl;
    });

    bnBtn.addEventListener('click', function(e){
      e.preventDefault();
      setActiveBtn(bnBtn);
      window.location.href = targetSite;
    });
  })();
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
import { firebaseConfig } from './assets/Firebase-Config/FirebaseConfig.js';

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const productList = document.getElementById('product-list');
const searchInput = document.getElementById("searchInput");
const suggestions = document.getElementById("suggestions");

let allProducts = [];
let cart = JSON.parse(localStorage.getItem('cart')) || [];

function calculateDiscountPrice(price, discountPercent, discountAmount){
    let finalPrice = parseFloat(price)||0;
    const percentDisc = Math.round(finalPrice * (parseFloat(discountPercent)||0)/100);
    const amtDisc = parseFloat(discountAmount)||0;
    if(percentDisc>0) finalPrice -= percentDisc;
    else if(amtDisc>0) finalPrice -= amtDisc;
    return finalPrice;
}

onValue(ref(db, 'products/sector6'), snapshot => {
    productList.innerHTML = '';
    allProducts = [];
    if(!snapshot.exists()) return;

    snapshot.forEach(childSnap=>{
        const product = childSnap.val();
        product.id = childSnap.key;
        allProducts.push(product);

        const finalPrice = calculateDiscountPrice(product.price, product.discountPercent, product.discountAmount);

        const card = document.createElement('div');
        card.className = 'game-card';
        card.dataset.id = product.id;

        const cardImage = document.createElement('div');
        cardImage.className = 'card-image';
        cardImage.style.backgroundImage = product.media ? `url("${product.media}")` : "url('https://via.placeholder.com/300x200?text=Image+Not+Found')";

        const cardText = document.createElement('div');
        cardText.className = 'card-text';
        cardText.textContent = product.name || 'Unknown';

        card.appendChild(cardImage);
        card.appendChild(cardText);

        card.addEventListener('click', ()=>{
            const popup = document.createElement('div');
            popup.className = 'product-popup';
            const originalPrice = parseFloat(product.price)||0;
            const percentDisc = Math.round(originalPrice * (parseFloat(product.discountPercent)||0)/100);
            const amtDisc = parseFloat(product.discountAmount)||0;
            let discountedPrice = originalPrice;
            if(percentDisc>0) discountedPrice -= percentDisc;
            else if(amtDisc>0) discountedPrice -= amtDisc;

            let priceHTML = (percentDisc>0 || amtDisc>0) 
                ? `<div class="fake-input">মূল্য: <del>৳${originalPrice}</del> <span class="price-discount">৳${discountedPrice}</span></div>`
                : `<div class="fake-input">মূল্য: ৳${originalPrice}</div>`;

            let discountHTML = '';
            if(percentDisc>0) discountHTML += `<input type="text" value="ডিসকাউন্ট পার্সেন্ট (%): ${product.discountPercent}%" readonly>`;
            if(amtDisc>0) discountHTML += `<input type="text" value="ডিসকাউন্ট টাকা (৳): ${amtDisc}" readonly>`;

            popup.innerHTML = `
                <div class="popup-content">
                    <span class="close-popup">&times;</span>
                    <input type="text" value="পণ্যের নাম: ${product.name||''}" readonly>
                    <input type="text" value="ব্র্যান্ডের নাম: ${product.brand||''}" readonly>
                    <input type="text" value="ওজন: ${product.weight||''}" readonly>
                    ${priceHTML}
                    ${discountHTML}
                    <textarea rows="2" readonly>ট্যাগস: ${product.tags?product.tags.join(', '):''}</textarea>
                    <textarea rows="3" readonly>মূল বিষয়বস্তু: ${product.popupContent||''}</textarea>
                    <button class="add-to-cart">Add to Cart</button>
                </div>
            `;
            document.body.appendChild(popup);

            popup.querySelector('.close-popup').addEventListener('click', ()=>popup.remove());

            popup.querySelector('.add-to-cart').addEventListener('click', ()=>{
                const itemIndex = cart.findIndex(i => i.id === product.id);
                if(itemIndex>-1) {
                    cart[itemIndex].quantity = (cart[itemIndex].quantity||1)+1;
                } else {
                    cart.push({...product, quantity:1, finalPrice:discountedPrice});
                }
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();
                alert("✅ পণ্য কার্টে যোগ করা হয়েছে!");
                popup.remove();
            });
        });

        productList.appendChild(card);
    });
});

function updateCartCount(){
    const countSpan = document.getElementById('cart-count');
    const totalQty = cart.reduce((sum,item)=>sum+(parseInt(item.quantity)||1),0);
    if(totalQty>0){
        countSpan.style.display='inline-block';
        countSpan.textContent = totalQty;
    } else countSpan.style.display='none';
}

updateCartCount();

searchInput.addEventListener('input', ()=>{
    const query = searchInput.value.toLowerCase().trim();
    suggestions.innerHTML='';
    if(query===''){
        document.querySelectorAll('.game-card').forEach(c=>c.style.display='');
        return;
    }
    let matchedTags=[];
    allProducts.forEach(p=>{
        if(p.tags){
            p.tags.forEach(tag=>{
                if(tag.toLowerCase().startsWith(query) && !matchedTags.includes(tag)) matchedTags.push(tag);
            });
        }
    });
    matchedTags.forEach(tag=>{
        const div = document.createElement('div');
        div.className='suggestion-item';
        div.textContent=tag;
        div.addEventListener('click', ()=>{
            searchInput.value=tag;
            suggestions.innerHTML='';
            filterProductsByTag(tag);
        });
        suggestions.appendChild(div);
    });
    if(matchedTags.length===0){
        document.querySelectorAll('.game-card').forEach(c=>c.style.display='none');
    }
});

function filterProductsByTag(tag){
    const matchedProducts = allProducts.filter(p=>p.tags && p.tags.includes(tag));
    document.querySelectorAll('.game-card').forEach(card=>{
        if(matchedProducts.find(p=>p.id===card.dataset.id)){
            card.style.display='';
            card.classList.add('highlight');
            setTimeout(()=>card.classList.remove('highlight'),800);
        } else card.style.display='none';
    });
}
</script>
</body>
</html>