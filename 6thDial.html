<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>‡¶®‡¶ø‡¶§‡ßç‡¶Ø ‡¶∏‡¶¶‡¶æ‡¶á</title>
<link rel="icon" type="image/png" href="favicon.png">
<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="assets/css/styles2.css">
<link rel="stylesheet" href="assets/css/styles22.css">
<style>
 

</style>
</head>
<body>
<div id="preloader">
  <div class="preloader-content">
    <img src="assets/images/logo.png" alt="Logo" class="preloader-logo">
    <div class="loader"></div>
    <div class="typing-text"><span class="text"></span><span class="cursor">|</span></div>
  </div>
</div>
<header>
 <img src="assets/images/logo.png" alt="Logo" class="header-logo">
  ‡¶®‡¶ø‡¶§‡ßç‡¶Ø <span class="span-all"> ‡¶∏‡¶¶‡¶æ‡¶á</span>
</header>
<marquee><i class="fas fa-tags"></i> ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶Ö‡¶´‡¶æ‡¶∞! ‡¶ö‡¶æ‡¶≤, ‡¶°‡¶æ‡¶≤, ‡¶§‡ßá‡¶≤, ‡¶ö‡¶ø‡¶®‡¶ø ‡¶∏‡¶π ‡¶∏‡¶¨ ‡¶™‡¶£‡ßç‡¶Ø‡ßá ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶õ‡¶æ‡ßú ‡¶ö‡¶≤‡¶õ‡ßá‡•§ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®!</marquee>

<div class="search-box">
  <input type="text" id="searchInput" placeholder="üîç ‡¶™‡¶£‡ßç‡¶Ø ‡¶¨‡¶æ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶ó‡¶∏ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">
  <div class="suggestions" id="suggestions"></div>
</div>

<div class="game-section">
  <h3>‡¶Ö‡¶≤ ‡¶¨‡ßá‡¶¨‡¶ø ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ!</h3>
  <div class="game-types" id="product-list"></div>
</div>

<div class="contact-menu">
  <div class="contact-btn"><i class="fas fa-comment-dots"></i></div>
  <div class="contact-options">
    <a href="https://wa.me/8801300226699" class="option" title="WhatsApp" target="_blank"><i class="fab fa-whatsapp"></i></a>
    <a href="tel:+01300226699" class="option" title="Call"><i class="fas fa-phone"></i></a>
    <a href="mailto:nittosodai2025@gmail.com" class="option" title="Email"><i class="fas fa-envelope"></i></a>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const contactBtnEl = document.querySelector('.contact-btn');
  const contactMenuEl = document.querySelector('.contact-menu');
  const popupMenuEl = document.getElementById('profile-popup');
  const enBtn = document.getElementById('en-btn');
  const bnBtn = document.getElementById('bn-btn');

  contactBtnEl.addEventListener('click', e => {
    e.stopPropagation();
    contactMenuEl.classList.toggle('active');
  });

  document.addEventListener('click', e => {
    if (!contactMenuEl.contains(e.target)) contactMenuEl.classList.remove('active');
  });

  

  function setActiveBtn(activeBtn) {
    bnBtn.classList.remove('active');
    enBtn.classList.remove('active');
    activeBtn.classList.add('active');
  }

  bnBtn.addEventListener('click', e => {
    e.preventDefault();
    setActiveBtn(bnBtn);
    popupMenuEl.style.display = 'none';
    window.location.href = '#';
  });

  enBtn.addEventListener('click', e => {
    e.preventDefault();
    setActiveBtn(enBtn);
    popupMenuEl.style.display = 'none';
    window.location.href =
      'https://translate.google.com/translate?sl=auto&tl=en&u=' +
      encodeURIComponent(window.location.href);
  });
  const profileBtn = document.getElementById('profile-btn');
  profileBtn.addEventListener('click', e => {
    e.preventDefault();
    popupMenuEl.style.display =
      popupMenuEl.style.display === 'block' ? 'none' : 'block';
  });

  document.addEventListener('click', e => {
    if (!popupMenuEl.contains(e.target) && !profileBtn.contains(e.target)) {
      popupMenuEl.style.display = 'none';
    }
  });
});
</script>


<footer>
  <div class="footer-container">
    <div class="footer-left">
      <h2>
  <a href="https://t.me/gmailmarketingofficiall" target="_blank">
    <img src="assets/images/logo.png" alt="Logo" class="footer-logo">
  </a>
  ‡¶®‡¶ø‡¶§‡ßç‡¶Ø<span class="span-all"> ‡¶∏‡¶¶‡¶æ‡¶á</span> ‚Äî ‡¶â‡¶á‡¶• ‡¶∏‡¶æ‡¶¨‡¶ø‡¶∞‡¶ø‡¶®
</h2>
      <p><i class="fas fa-copyright"></i> ‡¶è‡¶á ‡¶∏‡¶æ‡¶á‡¶ü‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶Ç‡¶∂ ‡¶¨‡¶æ Ui ‡¶¨‡¶æ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßá ‡¶§‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡ßá ‡¶è‡¶ï‡¶∂‡¶® ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶¨‡ßá! | Created By </p> <a class="Xrabon" href="https://t.me/XrabonProgrammer" target="_blank">Xrabon!</a>
    </div>
    <div class="footer-right">
       <a href="https://m.facebook.com/nittosodai.coms/"><i class="fab fa-facebook-f"></i></a>      
      <a href="https://www.instagram.com/nittosodai.coms/"><i class="fab fa-instagram"></i></a>
      <a href="https://youtube.com/@nittosodai-sabirin?si=eaj5s_bIryV8kizA"><i class="fab fa-youtube"></i></a>
    </div>
  </div>
</footer>

<div class="navbar">
  <a href="index.html" class="nav-item active"><i class="fa-solid fa-house"></i> ‡¶π‡ßã‡¶Æ</a>
  <a href="#" class="nav-item" id="profile-btn"><i class="fa-solid fa-globe"></i> ‡¶≠‡¶æ‡¶∑‡¶æ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü‡¶∞</a>
  <a href="NewCart.html" class="nav-item"><i class="fa-solid fa-cart-arrow-down"></i> <span id="cart-count">0</span> ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü‡¶∏</a>
  <a href="https://maps.app.goo.gl/ccqRvcB8uH9peCRq6", "_blank" class="nav-item" id="location-btn">
  <i class="fas fa-map-marked"></i> ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®
</a>
  <a href="#" class="nav-item" id="seller-btn"><i class="fas fa-user"></i> ‡¶™‡¶£‡ßç‡¶Ø ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ</a>
</div>

<div id="profile-popup" class="popup-menu">
  <button id="bn-btn" class="active" style="margin-bottom: 20px;"><img src="https://flagcdn.com/bd.svg" class="flag-icon"> ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</button>
  <button id="en-btn"><img src="https://flagcdn.com/us.svg" class="flag-icon"> English</button>
</div>

<div id="custom-modal" class="custom-modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <img id="modal-img" class="modal-img" src="">
    <h2 id="modal-title"></h2>
    <div class="modal-text" id="modal-text"></div>
  </div>
</div>
<script src="assets/js/script.js"></script>
<script src="assets/js/preloader.js"></script>
<script type="module">
 
 import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
import { firebaseConfig } from './assets/Firebase-Config/FirebaseConfig.js';
import { push, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const productList = document.getElementById('product-list');
const searchInput = document.getElementById("searchInput");
const suggestions = document.getElementById("suggestions");

const SECTOR_NUMBER = 6;

let allProducts = [];
let cart = JSON.parse(localStorage.getItem('cart')) || [];

function updateCartCount() {
    const countSpan = document.getElementById('cart-count');
    const totalQty = cart.reduce((sum, item) => sum + (parseInt(item.quantity) || 1), 0);
    if (totalQty > 0) {
        countSpan.style.display = 'inline-block';
        countSpan.textContent = totalQty;
    } else countSpan.style.display = 'none';
}

updateCartCount();

function calcDiscountPercent(originalPrice, discountAmount) {
    if (originalPrice === 0) return 0;
    return Math.round((discountAmount / originalPrice) * 100);
}

function renderProducts(products) {
    productList.innerHTML = '';
    products.forEach((product, index) => {
        product.idNumber = index + 1;
        allProducts.push(product);

        const card = document.createElement('div');
        card.className = 'game-card';
        card.dataset.id = product.id;

        const cardImage = document.createElement('div');
        cardImage.className = 'card-image';
        cardImage.style.backgroundImage = product.media
            ? `url("${product.media}")`
            : "url('https://via.placeholder.com/300x200?text=Image+Not+Found')";

        const cardText = document.createElement('div');
        cardText.className = 'card-text';
        cardText.textContent = product.name || 'Unknown';

        card.appendChild(cardImage);
        card.appendChild(cardText);

        let discountPercent = 0;
        const price = Number(product.price) || 0;
        const discountAmount = Number(product.discountAmount) || 0;
        const discountPercentField = Number(product.discountPercent) || 0;

        if (discountPercentField > 0) discountPercent = discountPercentField;
        else if (price > 0 && discountAmount > 0) discountPercent = Math.round((discountAmount / price) * 100);

        if (discountPercent > 0) {
            const badge = document.createElement('div');
            badge.className = 'discount-badge';
            badge.textContent = `-${discountPercent}%`;
            card.appendChild(badge);
        }

        card.addEventListener('click', () => showProductPopup(product));
        productList.appendChild(card);
    });

    const selected = JSON.parse(localStorage.getItem("selectedProduct"));
    if (selected && selected.sector === SECTOR_NUMBER && selected.tag) {
        searchInput.value = selected.tag;
        filterProductsByTag(selected.tag);
        localStorage.removeItem("selectedProduct");
    }
}

function openReviewModal(productId){
  const old = document.querySelector('.review-modal');
  if(old) old.remove();

  const modal = document.createElement('div');
  modal.className = 'review-modal';

  modal.innerHTML = `
    <div class="review-content">
      <span id="closeReview">&times;</span>
       <h3 style="font-size: 17px;
    margin-bottom: 20px;
    color: #fff;
    text-align: center;
    font-weight: bold;
    background: red;
    padding: 10px;
    margin-right: 30px;
    margin-left: 30px;
    border-radius: 48px;
    border: ppx solid black;
    margin: 10px 20px;">‡¶¨‡ßç‡¶Ø‡¶æ‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶¶‡ßá‡¶∞ ‡¶Æ‡¶§‡¶æ‡¶Æ‡¶§!</h3>
      <div id="reviewList">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>

      <textarea id="reviewText" rows="3" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶§‡¶æ‡¶Æ‡¶§ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
      <button id="submitReview">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
  `;

  document.body.appendChild(modal);

  modal.querySelector('#closeReview').onclick = ()=> modal.remove();

  const reviewList = modal.querySelector('#reviewList');
  const reviewRef = ref(db, `reviews/${productId}`);

  // üî• ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶≤‡ßã‡¶°
  onValue(reviewRef, snap=>{
    reviewList.innerHTML = '';
    if(!snap.exists()){
      reviewList.innerHTML = '<p>‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶®‡ßá‡¶á</p>';
      return;
    }

    snap.forEach(child=>{
      const r = child.val();
      reviewList.innerHTML += `
        <div class="review-item">
          <i class="fa-solid fa-user"></i>
          <div class="review-text">${r.text}</div>
        </div>
      `;
    });
  });

  // üî• ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â
  modal.querySelector('#submitReview').onclick = ()=>{
    const text = modal.querySelector('#reviewText').value.trim();
    if(!text) return alert("‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®");

    const newRef = push(reviewRef);
    set(newRef,{
      text: text,
      time: Date.now()
    });

    modal.querySelector('#reviewText').value = '';
  };
}
function showProductPopup(product) {
    const oldPopup = document.querySelector('.product-popup');
    if (oldPopup) oldPopup.remove();

    const popup = document.createElement('div');
    popup.className = 'product-popup';

    const originalPrice = Number(product.price) || 0;
    const discountAmount = Number(product.discountAmount) || 0;
    const discountPercent = Number(product.discountPercent) || 0;

    let discountedPrice = originalPrice;
    if (discountAmount > 0) discountedPrice = originalPrice - discountAmount;
    else if (discountPercent > 0) discountedPrice = originalPrice - Math.round(originalPrice * discountPercent / 100);

    let priceHTML = '';
    if (discountedPrice < originalPrice) {
    priceHTML = `
    <div class="fake-input">
        <del style="text-decoration: line-through; color: red;">‡ß≥${originalPrice}</del>
        <span class="price-discount" style="font-weight:bold; color:green;">‡ß≥${discountedPrice}</span>
    </div>`;
}

    const displayDiscountPercent = discountAmount > 0 
        ? Math.round((discountAmount / originalPrice) * 100) 
        : discountPercent;
    const discountHTML = displayDiscountPercent > 0 
        ? `<input type="text" value="‡¶°‡¶ø‡¶∏‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü (%): ${displayDiscountPercent}%" readonly>` 
        : '';

    popup.innerHTML = `
        <div class="popup-content">
            <span class="close-popup">&times;</span>
            <img src="${product.media ? product.media : 'https://via.placeholder.com/300x200?text=Image+Not+Found'}" alt="${product.name || 'Product Image'}">
            <input type="text" value="‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ: ${product.name || ''}" readonly>
            <input type="text" value="Product ID: NittoSodai-${String(product.idNumber).padStart(2,'0')}" readonly>
            <input type="text" value="‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ: ${product.brand || ''}" readonly>
            <input type="text" value="‡¶ì‡¶ú‡¶®: ${product.weight || ''}" readonly>
            ${priceHTML}
            ${discountHTML}
            <textarea rows="2" readonly>‡¶ü‡ßç‡¶Ø‡¶æ‡¶ó‡¶∏: ${product.tags ? product.tags.join(', ') : ''}</textarea>
            <textarea rows="3" readonly>‡¶Æ‡ßÇ‡¶≤ ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º‡¶¨‡¶∏‡ßç‡¶§‡ßÅ: ${product.popupContent || ''}</textarea>
            <button class="add-to-cart">‡¶ï‡¶æ‡¶∞‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
<button class="review-btn">‡¶Æ‡¶§‡¶æ‡¶Æ‡¶§</button>
    `;

    document.body.appendChild(popup);

    popup.querySelector('.close-popup').addEventListener('click', () => popup.remove());

    popup.querySelector('.add-to-cart').addEventListener('click', () => {
        const itemIndex = cart.findIndex(i => i.id === product.id);
        if (itemIndex > -1) cart[itemIndex].quantity = (cart[itemIndex].quantity || 1) + 1;
        else cart.push({ ...product, quantity: 1, finalPrice: discountedPrice });
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        alert("‚úÖ ‡¶™‡¶£‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
        popup.remove();
    });
    popup.querySelector('.review-btn').addEventListener('click', (e) => {
    e.stopPropagation(); // ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶Ø‡ßá‡¶® ‡¶®‡¶æ ‡¶≤‡¶æ‡¶ó‡ßá
    openReviewModal(product.id);
});
}

 
onValue(ref(db, `products/sector${SECTOR_NUMBER}`), snapshot => {
    allProducts = [];
    if (!snapshot.exists()) return;

    const productsArray = [];
    snapshot.forEach(childSnap => {
        const product = childSnap.val();
        product.id = childSnap.key;
        productsArray.push(product);
    });

    productsArray.sort((a, b) => {
        if (a.isLast) return 1;
        if (b.isLast) return -1;
        return 0;
    });

    renderProducts(productsArray);
});

searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase().trim();
    suggestions.innerHTML = '';
    if (query === '') {
        document.querySelectorAll('.game-card').forEach(c => c.style.display = '');
        return;
    }

    let matchedTags = [];
    allProducts.forEach(p => {
        if (p.tags) p.tags.forEach(tag => {
            if (tag.toLowerCase().startsWith(query) && !matchedTags.includes(tag)) matchedTags.push(tag);
        });
    });

    matchedTags.forEach(tag => {
        const div = document.createElement('div');
        div.className = 'suggestion-item';
        div.innerHTML = `<i class="fa fa-box"></i> ${tag}`;
        div.addEventListener('click', () => {
            searchInput.value = tag;
            suggestions.innerHTML = '';
            filterProductsByTag(tag);
        });
        suggestions.appendChild(div);
    });

    if (matchedTags.length === 0) 
        document.querySelectorAll('.game-card').forEach(c => c.style.display = 'none');
});

function filterProductsByTag(tag) {
    const matchedProducts = allProducts.filter(p => p.tags && p.tags.includes(tag));
    document.querySelectorAll('.game-card').forEach(card => {
        if (matchedProducts.find(p => p.id === card.dataset.id)) {
            card.style.display = '';
            card.classList.add('highlight');
            setTimeout(() => card.classList.remove('highlight'), 800);
        } else card.style.display = 'none';
    });
}


</script>
</body>
</html>
