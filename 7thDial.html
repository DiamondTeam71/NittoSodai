<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>নিত্য সদাই</title>
<link rel="icon" type="image/png" href="favicon.png">
<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="assets/css/styles2.css">
</head>
<body>
<header><i class="fas fa-store"></i>নিত্য <span class="span-all">সদাই</span></header>
<marquee><i class="fas fa-tags"></i> আজকের বিশেষ অফার! চাল, ডাল, তেল, চিনি সহ সব পণ্যে বিশেষ ছাড় চলছে। দ্রুত অর্ডার করুন!</marquee>
<div class="search-box">
  <input type="text" id="searchInput" placeholder="পণ্য বা ট্যাগস খুঁজুন...">
  <div class="suggestions" id="suggestions"></div>
</div>
<div class="game-section">
  <h3>ইলেকট্রনিক্স ও অন্যান্য!</h3>
  <div class="game-types" id="product-list"></div>
</div>
<footer>  
  <div class="footer-container">  
    <div class="footer-left">  
      <h2><i class="fas fa-store"></i> নিত্য <span class="span-all">সদাই</span></h2>  
      <p><i class="fas fa-copyright"></i> এই সাইটের কোনো অংশ বা Ui বা ডিজাইন কপি করা হলে তার বিরুদ্ধে একশন নেওয়া হবে! | Created By <span>Xrabon</span></p>  
    </div>  
    <div class="footer-right">  
      <a href="#"><i class="fab fa-facebook-f"></i></a>  
      <a href="#"><i class="fab fa-twitter"></i></a>  
      <a href="#"><i class="fab fa-instagram"></i></a>  
      <a href="#"><i class="fab fa-youtube"></i></a>  
    </div>  
  </div>  
</footer>  

<div class="navbar">
  <a href="index.html" class="nav-item active" style="text-decoration:none;">
    <i class="fa-solid fa-house"></i>
    Home
  </a>
  <a href="UserProfileDashboard.html" class="nav-item" style="text-decoration:none;">
    <i class="fa-solid fa-user"></i>
   Profile
  </a>
  <a href="HeavyCart.html" class="nav-item" style="text-decoration:none;">
    <i class="fa-solid fa-cart-arrow-down"></i>
    <span id="cart-count">0</span>
    Carts
  </a> 
  <a href="#" class="nav-item" style="text-decoration:none;">
    <i class="fas fa-user"></i>
    Developer
  </a>
  <a href="#" class="nav-item" style="text-decoration:none;">
    <i class="fas fa-user"></i>
    Seller
  </a>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
import { firebaseConfig } from './assets/Firebase-Config/FirebaseConfig.js';

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const productList = document.getElementById('product-list');
const searchInput = document.getElementById("searchInput");
const suggestions = document.getElementById("suggestions");
let allProducts = [];
let cart = JSON.parse(localStorage.getItem('cart')) || [];

onValue(ref(db, 'products/sector7'), snapshot => {
    productList.innerHTML = '';
    allProducts = [];
    if (!snapshot.exists()) return;

    snapshot.forEach(childSnap => {
        const product = childSnap.val();
        product.id = childSnap.key;
        allProducts.push(product);

        const card = document.createElement('div');
        card.className = 'game-card';
        card.dataset.id = product.id;

        const cardImage = document.createElement('div');
        cardImage.className = 'card-image';
        cardImage.style.backgroundImage = product.media ? `url("${product.media}")` : "url('https://srabonprogrammer.netlify.app/cpd.png')";

        const cardText = document.createElement('div');
        cardText.className = 'card-text';
        cardText.textContent = product.name || 'Unknown';

        card.appendChild(cardImage);
        card.appendChild(cardText);

        card.addEventListener('click', () => {
            const popup = document.createElement('div');
            popup.className = 'product-popup';
            popup.innerHTML = `
                <div class="popup-content">
                    <span class="close-popup">&times;</span>
                    <input type="text" value="পণ্যের নাম: ${product.name||''}" readonly>
                    <input type="text" value="ব্র্যান্ডের নাম: ${product.brand||''}" readonly>
                    <input type="text" value="ওজন: ${product.weight||''}" readonly>
                    <input type="text" value="মূল্য: ৳${product.price||''}" readonly>
                    <textarea rows="2" readonly>ট্যাগস: ${product.tags?product.tags.join(', '):''}</textarea>
                    <textarea rows="3" readonly>মূল বিষয়বস্তু: ${product.popupContent||''}</textarea>
                    <button class="add-to-cart">Add to Cart</button>
                </div>`;
            document.body.appendChild(popup);

            popup.querySelector('.close-popup').addEventListener('click', () => popup.remove());
            popup.querySelector('.add-to-cart').addEventListener('click', () => {
                const itemIndex = cart.findIndex(i => i.id === product.id);
                if(itemIndex > -1) cart[itemIndex].quantity = (cart[itemIndex].quantity || 1) + 1;
                else cart.push({...product, quantity:1});
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();
                alert(`${product.name} কার্টে যুক্ত হয়েছে!`);
                popup.remove();
            });
        });

        productList.appendChild(card);
    });
});

function updateCartCount() {
    const countSpan = document.getElementById('cart-count');
    const totalQty = cart.reduce((sum, item) => sum + (parseInt(item.quantity) || 1), 0);
    if(totalQty > 0){
        countSpan.style.display = 'inline-block';
        countSpan.textContent = totalQty;
    } else {
        countSpan.style.display = 'none';
    }
}
updateCartCount();

searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase().trim();
    suggestions.innerHTML = '';

    if(query === ''){
        document.querySelectorAll('.game-card').forEach(c => c.style.display = '');
        return;
    }

    let matchedTags = [];
    allProducts.forEach(p => {
        if(p.tags){
            p.tags.forEach(tag => {
                if(tag.toLowerCase().startsWith(query) && !matchedTags.includes(tag)) matchedTags.push(tag);
            });
        }
    });

    matchedTags.forEach(tag => {
        const div = document.createElement('div');
        div.className = 'suggestion-item';
        div.textContent = tag;
        div.addEventListener('click', () => {
            searchInput.value = tag;
            suggestions.innerHTML = '';
            filterProductsByTag(tag);
        });
        suggestions.appendChild(div);
    });

    if(matchedTags.length === 0){
        document.querySelectorAll('.game-card').forEach(c => c.style.display = 'none');
    }
});

function filterProductsByTag(tag) {
    const matchedProducts = allProducts.filter(p => p.tags && p.tags.includes(tag));
    const allCards = document.querySelectorAll('.game-card');
    allCards.forEach(card => {
        if(matchedProducts.find(p => p.id === card.dataset.id)){
            card.style.display = '';
            card.classList.add('highlight');
            setTimeout(() => card.classList.remove('highlight'), 800);
        } else {
            card.style.display = 'none';
        }
    });
}
</script>
</body>
</html>